<include file="public/header" title="修改实体店信息" body=""/>
<include file="public/header_nav" title="修改实体店信息" href="javascript:history.back(-1)"/>
<!--<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">-->
<style>
    body{
        max-width: 100%;
    }
    /*.loginsingup-input,.edit .myorder .order .fl input,.myorder .order .fl span{ font-size: 0.256rem;}*/
    select{
        appearance: none;
        -moz-appearance: none;
        -webkit-appearance: none;
    }
    .ditu{
        margin-top: 0.1rem;
        text-align: left;
		height:16rem;
    }
	.ditu li{ font-size:.32rem; line-height:normal}
	.list7 .myorder{line-height:normal}
    .iframebox{
        /*position: fixed;*/
    }

    #iframe{
        position: fixed;
        left:0;
        top:0;
        right: 0;
        bottom: 0;
        background: #fff;
    }
    .iframebox{
        margin-left: 2rem;
        margin-top: 0.21rem;
        text-align: center;
    }
    .thubmbox{
        width: 100%; padding-bottom:20px;
        overflow: hidden;
    }
    .thubmbox img{
        width: 100%;
    }
	#address {
        position: absolute;
        z-index: 9999;
        top: 1rem;
        left:50% ;
        width: 10rem;
        margin-left:-5rem;
        height:1.5rem;
    }
</style>
<!--<script src="__STATIC__/js/jquery-2.1.1.min.js"></script>-->
<link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />
<script src="https://webapi.amap.com/maps?v=1.4.0&key=34757d6f3a85d3ad5fac697a62f0204f&plugin=AMap.Geocoder" type="text/javascript"></script>
<script src="https://webapi.amap.com/ui/1.0/main.js?v=1.0.10"></script>
<script src="https://webapi.amap.com/demos/js/liteToolbar.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/amap.js" type="text/javascript"></script>
<!--地图API-->
<!--注册表单-s-->
<div class="loginsingup-input">
	<form method="get" id="handlepost" name="form1" action="{:U('/mobile/admin/index')}" onsubmit="return check_yzm();">
        <div class="lsu">
            <div class="line_1">
                <span class="ico ico-telephone ys"></span>
                <input type="text" name="mobile" id="mobile" value="{$Request.param.mobile}" placeholder="请输入手机号"  class="c-form-txt-normal">
            </div>
            <div class="line_1">
                <input type="text" name="mobile_code" id="mobile_code" class="c_code_msg2" placeholder="6位验证码">
    		    <div class="fsyz"  rel="mobile"  onClick="sendcode(this)">获取验证码</div>
            </div>
            <span id="mobile_phone_notice"></span>
        </div>
        <div class="lsu-submit">
            <input type="submit" value="查询实体店"/>
        </div>
    </form>
</div>
<script>
function check_yzm(){
	if($("#mobile_code").val() == ''){
		showErrorMsg('查询实体店时请输入您的验证码');
		return false;
	}
	return true;
}
	//发送短信验证码
    function sendcode(obj){
		var tel = $("#mobile").val()
         if(tel == ''){
            showErrorMsg('请输入您的手机号');
            return false;
        }else if(checkMobile(tel)) {
			$.ajax({
				url : "/index.php?m=Home&c=Api&a=send_validate_code&scene=6&type=mobile&send="+tel,
				type:'post',
				dataType:'json',
				data:{send:tel},
				success:function(res){
					if(res.status==1){
						//成功
						showErrorMsg(res.msg);
						countdown(obj);
					}else{
						//失败
						showErrorMsg(res.msg);
						$(obj).text('请刷新再试！');
						$(obj).attr('id','fetchcode');
					}
				}
			})
		}else{
			showErrorMsg('您的手机号码有误，请重新输入');
            return false;	
		}
    }

    function countdown(obj){
        var obj = $(obj);
        var s = {$sms_time_out};
        //改变按钮状态
        obj.unbind('click');
        //添加样式
        obj.attr('id','fetchcode');
        callback();
        //循环定时器
        var T = window.setInterval(callback,1000);
        function callback()
        {
            if(s <= 0){
                //移除定时器
                window.clearInterval(T);
                obj.bind('click',sendcode)
                obj.removeAttr('id','fetchcode');
                obj.text('获取验证码');
            }else{
                obj.text(--s + '秒后再试');
            }
        }
    }
</script>
<if condition="$item">
<div class="floor p edit">
    <form action="{:U('/mobile/admin/')}" method="post" id="addressForm">
        <div class="loginsingup-input">
        <div class="content">
            <div class="floor list7">
                <div class="myorder p" style="padding: 0;">
                    <div class="content30">
                        <a href="javascript:void(0)">
                            <div class="order">
                                <div class="fl">
                                    <span>手机号:</span>
                                </div>
                                <div class="fl" style="color: #999;">
                                    <input type="text" value="{$Request.param.mobile}" name="mobile" readonly="readonly"/>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                <if condition="$recommender.cname">
                <div class="myorder p"  style="padding: 0;">
                    <div class="content30">
                        <a href="javascript:void(0)">
                            <div class="order">
                                <div class="fl">
                                    <span>推荐子公司（谁推荐的）:</span>
                                    {$recommender.cname}
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                </if>
                <div class="myorder p"  style="padding: 0;">
                    <div class="content30">
                        <a href="javascript:void(0)" onclick="tkaddres();">
                            <div class="order">
                                <div class="fl">
                                    <span>所在地区: </span>
                                    <span id="area" style="color: #999;">
                                    	<empty name="item['province_name']">点击选择所属地区</empty>
                                        {$item.province_name} {$item.city_name} {$item.district_name}
                                    </span>
                                    <input type="hidden" value="{$item['province_id']}" name="province" class="hiddle_area"/>
                                    <input type="hidden" value="{$item['city_id']}" name="city" class="hiddle_area"/>
                                    <input type="hidden" value="{$item['district_id']}" name="district" class="hiddle_area"/>
                                </div>

                            </div>
                        </a>
                    </div>
                </div>
                <div class="myorder p"  style="padding: 0;">
                    <div class="content30">
                        <a href="javascript:void(0)">
                            <div class="order">
                                <div class="fl">
                                    <span>地图: &nbsp;</span>
                                </div>
                                <div class="ditu" id="ditu">
									<input id="address" name="address" value="{$item.address}"  class="input-txt" type="text" style="display:none"/>
                                </div>
								<script>
                                    mapsamp('{$item.lng}','{$item.lat}');
                                    $(function (){
                                        $("#address").show();
                                    })
                                </script>
                                    
									<input id="lng" name="lng" value="{$item.lng}"  class="input-txt" type="hidden"/>
									<input id="lat" name="lat" value="{$item.lat}"  class="input-txt" type="hidden"/>
                            </div>
                        </a>
                    </div>
                </div>
                
                <div  class="myorder p"  style="padding: 0;margin-top:.5rem">
                    <div class="content30">
						<div class="fl">
                              <span>缩略图:</span>
							</div>
                            
                            <div class="iframebox"  <if condition="!$item.litpic"> style="display:none;" </if>>
                                <div class="thubmbox"><img src='{$item.litpic}' id='thubm' style="max-height:10rem; max-width:10rem;"></div>
							</div>
                            
                           
                            <label class="fileContainer">点击上传图片<input type="file" accept='image/*' name="fileData" id="fileData" /></label>
                            <script>
                            	$("#fileData").bind('change',upload_litpic);
								function upload_litpic(){
									
									formdata = new FormData();
									formdata.append('fileData',$("#fileData")[0].files[0]);
									formdata.append('cid',$("#cid").val());	
									$('.fileContainer').html('正在上传..');								
									$.ajax({
										url:"{:url('/Mobile/admin/addThumb')}",
										type:'POST',
										cache:false,
										data:formdata,
										dataType:'json',
										processData:false,
										contentType:false,
										success:function(data,status,xhr){
											$('.fileContainer').html("点击上传图片<input type='file' accept='image/*' name='fileData' id='fileData' />")
											$("#fileData").unbind('change');
											$("#fileData").bind('change',upload_litpic);
											if(data.status == 1){
												$("#thubm").attr('src',data.info+'?v='+Math.random());
												$('.iframebox').show();
											}else{
												alert(data.info);
											}
										}
									});
								}
                            </script>
							<input type="hidden" name="cid" id="cid" value="{$item.cid}"/>
						</div>
					</div>
				</div>
			<div class="lsu-submit">
				<input type="button" onclick="checkCompanyUpdate();" value="保存"/>
			</div>
        </div>
        </div>
    </form>
</div>
</if>

<div class="mask-filter-div" style="display: none;"></div>
<script src="/template/mobile/new2/static/js/tk_location.js?v=1.0.0.5"></script>
<!--选择地区-s-->
<div class="container"  >
    <div class="city">
        <div class="screen_wi_loc">
            <div class="classreturn loginsignup">
                <div class="content">
                    <div class="ds-in-bl return seac_retu">
                        <a href="javascript:void(0);" onclick="closelocation();"><img src="__STATIC__/images/return.png" alt="返回"></a>
                    </div>
                    <div class="ds-in-bl search center">
                        <span class="sx_jsxz">选择地区</span>
                    </div>
                    <div class="ds-in-bl suce_ok">
                        <a href="javascript:void(0);">&nbsp;</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="province-list"></div>
        <div class="city-list" style="display:none"></div>
        <div class="area-list" style="display:none"></div>
    </div>
</div>
<!--选择地区-e-->
<script>
    
    function cloaselayer(){
        layer.closeAll();
    }


 function checkCompanyUpdate(){
	$.ajax({  
		url: "/index.php/mobile/admin/add",  
		type: 'POST',  
		data:$("#addressForm").serialize(),  
		dataType: 'json',  
		error: function(){alert('请刷新重试')},
		success: function(r){
			showErrorMsg('数据更新成功！');
		}		
	});  
	return false;
	
}
</script>
<style type="text/css">

.fileContainer {

    overflow: hidden;

    position: relative;

}

 

.fileContainer [type=file] {

    cursor: inherit;

    display: block;

    font-size: 999px;

    filter: alpha(opacity=0);

    min-height: 100%;

    min-width: 100%;

    opacity: 0;

    position: absolute;

    right: 0;

    text-align: right;

    top: 0;

}

 

/* Example stylistic flourishes */

 

.fileContainer {

    background: #fff;

    border-radius: .5em;

    

    padding: 0 .5em;
	border:1px solid #aaa;
	font-size:.65rem;
	line-height:1rem;
	margin-left:1rem;
	
	width:5rem;
	position:relative;
	left:50%;
	margin-left:-2.5rem;

}

 

.fileContainer [type=file] {

    cursor: pointer;

}

}

</style>

</body>
</html>