<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="renderer" content="webkit">
<title>我的订单</title>
<meta name="keywords" content="{$tpshop_config['shop_info_store_keyword']}"/>
<meta name="description" content="{$tpshop_config['shop_info_store_desc']}"/>
<link rel="shortcut  icon" type="image/x-icon" href="{$tpshop_config['shop_info_store_ico']}" media="screen"  />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
<link href="__STATIC__/css/style.css?v={$vnum}" rel="stylesheet">
<link href="__STATIC__/css/member.css?v={$vnum}" rel="stylesheet">
<script src="__STATIC__/js/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/layer/layer.js" type="text/javascript"></script>
<script type="text/javascript" src="__ROOT__/public/static/js/layer/laydate/laydate.js"></script>
<script src="__PUBLIC__/js/baidu.js"></script>
</head>

<body class="bgg">
	<include file="public/user_header" />
	<div class="clear"></div>
	
	<div class="y-content">
		<!--左侧菜单-->
		<include file="public/user_lefter" />
		
		<!--右侧内容-->
		<div class="y-right y-borm fri">
			<div class="y-zua">
				<ul class="tpo fle">
					<li><a href="{:U('Order/order_list')}" class="<if condition="$Request.param.type eq ''">on</if>">所有订单</a></li>
					<li><a href="{:U('Order/order_list',array('type'=>'WAITPAY'))}" class="<if condition="$Request.param.type eq 'WAITPAY'">on</if>">待付款</a></li>
					<li><a href="{:U('Order/order_list',array('type'=>'WAITSEND'))}" class="<if condition="$Request.param.type eq 'WAITSEND'">on</if>">待发货</a></li>
					<li><a href="{:U('Order/order_list',array('type'=>'WAITRECEIVE'))}" class="<if condition="$Request.param.type eq 'WAITRECEIVE'">on</if>">待收货</a></li>
					<li><a href="{:U('Order/comment',array('status'=>'0'))}" class="<if condition="$Request.param.type eq 'WAITCCOMMENT'">selected</if>">待评价<span>{$com_num}</span></a></li>
				</ul>
				<form id="search_order" action="{:U('Order/order_list')}" method="get" class="y-souu fri">
					<input type="text" class="text fle" placeholder="输入商品标题或订单号进行搜索" name="search_key" id="search_key" value="{$Request.param.search_key}" />
					<input type="submit" class="sub fle" value="">
                </form>
			</div>
			
			<div class="orderbook-list">
                <div class="book-tit">
                    <ul>
                        <li class="sx1">商品</i></li>
                        <li class="sx2">单价</li>
                        <li class="sx3">数量</li>
                        <li class="sx4">实付款</li>
                        <li class="sx5 s5clic">交易状态<i class="jt-x"></i></li>
                        <li class="sx6">交易操作</li>
                    </ul>
                </div>
                <div class="hid-derei">
                    <ul>
                        <li><a href="{:U('Order/order_list')}">全部订单</a></li>
                        <li><a href="{:U('Order/order_list',array('type'=>'WAITPAY'))}">待付款</a></li>
                        <li><a href="{:U('Order/order_list',array('type'=>'WAITSEND'))}">待发货</a></li>
                        <li><a href="{:U('Order/order_list',array('type'=>'WAITRECEIVE'))}">待收货</a></li>
                        <li><a href="{:U('Order/comment',array('status'=>'0'))}">待评论</a></li>
                        <li><a href="{:U('Order/order_list',array('type'=>'FINISH'))}">已完成</a></li>
			    		<li><a href="{:U('Order/order_list',array('type'=>'CANCEL'))}">已取消</a></li>
                    </ul>
                </div>
			</div>
            <!--订单-->
            <empty name="lists">
            	<div class="car-none-pl">
                    <i class="account-acco1"></i>您还没有订单，<a href="/">快去逛逛吧~</a>
                </div>
            <else/>
			<style>
.y-dd .dbt .ljt{ text-align: center; font-size: 12px; color: #666;}
.y-dd .dbt .ljt a{ display: inline-block; font-size: 12px; padding: 0 10px; color: #666;}
.y-dd .dbt .ljt a:hover{ color: #000;}
			</style>
            	<volist name="lists" id="list">
		        	<table width="930" border="0" cellspacing="0" cellpadding="0" class="y-dd">
						<tr>
						    <td>
		                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="dbt">
								    <tr>
								        <td width="616" class="dh">{$list.add_time|date='Y-m-d H:i:s',###}      订单号: {$list.order_sn}</td>
								        <td width="300" class="ljt">
										<if condition="$list.pay_btn eq 1">
											<a class="ps_lj" href="{:U('Home/Cart/cart4',array('order_id'=>$list[order_id]))}"  target="_blank">立即支付</a>
										</if>
										<if condition="$list.order_button[cancel_info] eq 1">
											 <a class="consoorder" href="{:U('Order/cancel_order_info',array('order_id'=>$list[order_id]))}">取消详情</a>
										</if>
										<if condition="$list.receive_btn eq 1">
											<a class="ps_lj" href="javascript:;" onclick="order_confirm({$list.order_id});">确认收货</a>
										</if>
										<if condition="$list.cancel_btn eq 1">
											<if condition="$list[pay_status] eq 0">
											<a class="consoorder" href="javascript:void(0);" onClick="cancel_order({$list.order_id})" >取消订单</a>
											<else/>
											<a class="consoorder" href="javascript:void(0);" data-url="{:U('Home/Order/refund_order',['order_id'=>$list.order_id])}" onClick="refund_order(this)" >取消订单</a>
											</if>
										</if>
                                        
										</td>
								    </tr>
		                        </table>
								<style>
									.y-dd .dbt .ljt a{ padding: 0; width: 80px; height: 20px; line-height: 20px; background: #c5c5c5; float: right; margin-right: 10px; color: #000; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px;}
									.y-dd .dbt .ljt a:hover{ color: #fff; background: #ff6800;}
								</style>
						    </td>
						</tr>
						<tr>
						    <td>
		                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="dxq">
		                        	<volist name="list.goods_list" id="goods" key="k">
								    <tr>
								        <td width="393" class="xni">
								        	<a <if condition="$goods['is_allreturn'] eq '1'"> href="{:U('Home/ReturnGoods/goodsInfo',array('id'=>$goods['goods_id']))}" <else /> href="{:U('Home/Goods/goodsInfo',array('id'=>$goods['goods_id']))}" </if> ><img src="{$goods.goods_id|goods_thum_images=80,80}"></a>
								        	<div class="zi fle">
								        		<h3><a <if condition="$goods['is_allreturn'] eq '1'"> href="{:U('Home/ReturnGoods/goodsInfo',array('id'=>$goods['goods_id']))}" <else /> href="{:U('Home/Goods/goodsInfo',array('id'=>$goods['goods_id']))}" </if> >{$goods.goods_name}</a></h3>
								        		<p>{$goods.spec_key_name}</p>
								        	</div>
								        </td>
								        <td width="93" class="xni1">￥{$goods.member_goods_price}</td>
								        <td width="100" class="xni1">
								        	<span>x{$goods.goods_num}</span>
                                            <if condition="isset($goods[rstatus])">
                                            	<br />
	                                            <a class="applyafts">{$goods[rstatus_str]}</a>
	                                        <else />
	                                        	<br />
	                                            <a href="{:U('Home/Order/return_goods',['rec_id'=>$goods['rec_id']])}" class="applyafts">申请售后</a>
	                                        </if>
								        </td>
								        <if condition="$key eq 0">
										<td width="112" class="xni1" rowspan="{$list.goods_list|count}">
											<div class="pric_rhz">
												<p class="d_pri"><span>￥</span><span>{$list.order_amount}</span></p>
												<p class="d_yzo">
													<span>含运费：</span>
													<span>{$list.shipping_price}</span></p>
												<p class="d_yzo"><a href="javascript:void(0);">{$list.pay_name}</a></p>
											</div>
										</td>
								        <td width="126" class="xni1" rowspan="{$list.goods_list|count}">
								        	{$list['order_status_desc']}
								        	<br />
								        	<if condition="$list[order_prom_type] eq 5">
                                                <a href="{:U('Order/virtual_order',array('order_id'=>$list['order_id']))}">查看详情</a>
                                            <else/>
                                                <a href="{:U('Order/order_detail',array('id'=>$list['order_id']))}">查看详情</a>
                                            </if>
								        </td>
								        </if>
								        <td width="106" class="xni1">
								        	<if condition="($list[comment_btn] eq 1) and ($goods[is_comment] eq 0)">
								        		<a href="{:U('Home/Order/comment_list',array('order_id'=>$list['order_id'],'rec_id'=>$goods['rec_id']))}"><h6>评价</h6></a>
								        		<br />
								        	</if>
								        	<a href="{:U('Home/Goods/goodsInfo',array('id'=>$goods['goods_id']))}">再次购买</a>
								        </td>
								    </tr>
								    </volist>
		                        </table>
						    </td>
						</tr>
		        	</table>
	        	</volist>
	        </empty>

			<!--分页-->
            {$page}
			
		</div>
		<div class="clear"></div>
	</div>
	<include file="public/user_footer" />
	<script type="text/javascript">
	    $(function(){
	        $('.s5clic').click(function(){
	            $('.hid-derei').slideToggle(400);
	            $(this).animate({opacity:"1"},200,function(){
	                $(this).toggleClass('sxbb')
	            })
	        })
	    })
	    //取消订单
	    function cancel_order(id){
	        layer.confirm('确定取消订单?', {
	                    btn: ['确定','取消'] //按钮
	                }, function(){
	                    // 确定
	                    location.href = "/index.php?m=Home&c=Order&a=cancel_order&id="+id;
	                }, function(index){
	                    layer.close(index);
	                }
	        );
	    }

	    function jump()
	    {
	        var max_page = "{$page_array.total_page}";
	        var jump_page = $('#jump_page').val();
	        if(jump_page>0 && jump_page<=max_page){
	            location.href = "<?php echo urldecode(U('Home/Order/order_list',$get_no_p,''));?>"+"/p/"+$('#jump_page').val();
	        }else{
	            layer.alert('请输入正确的页数', {icon: 2});
	        }
	    }
	    //确定收货
	    function order_confirm(order_id){
	        layer.confirm("你确定收到货了吗?",{
	            btn:['确定','取消']
	        },function(){
	            $.ajax({
	                type : 'post',
	                url : '/index.php?m=Home&c=Order&a=order_confirm&order_id='+order_id,
	                dataType : 'json',
	                success : function(data){
	                    if(data.status == 1){
	                        window.location.href = data.url;
	                    }else{
	                        layer.open({content:data.msg,time:2});
	                        verify();
	                    }
	                },
	                error : function(XMLHttpRequest, textStatus, errorThrown) {
	                    layer.alert('网络失败，请刷新页面后重试', {icon: 2});
	                }
	            })
	        }, function(index){
	            layer.close(index);
	        });
	    }
	    
		function refund_order(obj){
			layer.open({
				type: 2,
				title: '<b>订单取消申请</b>',
				skin: 'layui-layer-rim',
				shadeClose: true,
				shade: 0.5,
				area: ['600px', '500px'],
				content: $(obj).attr('data-url'),
			});
		}
	</script>
</body>
</html>