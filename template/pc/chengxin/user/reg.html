<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="renderer" content="webkit">
<title>注册-{$tpshop_config['shop_info_store_title']}</title>
<meta name="keywords" content="{$tpshop_config['shop_info_store_keyword']}"/>
<meta name="description" content="{$tpshop_config['shop_info_store_desc']}"/>
<link rel="shortcut  icon" type="image/x-icon" href="{$tpshop_config['shop_info_store_ico']}" media="screen"  />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
<link href="__STATIC__/css/style.css?v={$vnum}" rel="stylesheet">
<link href="__STATIC__/css/second.css?v={$vnum}" rel="stylesheet">
<script src="__STATIC__/js/jquery-1.11.1.min.js" type="text/javascript" ></script>
<script type="text/javascript" src="__STATIC__/js/jquery.min.js"></script>
<script type="text/javascript" src="__STATIC__/js/style.js?v={$vnum}" ></script>
<script src="__PUBLIC__/js/layer/layer.js?v={$vnum}"></script><!--弹窗js 参考文档 http://layer.layui.com/-->    
<script src="__PUBLIC__/js/global.js?v={$vnum}"></script>
<script src="__PUBLIC__/js/baidu.js"></script>
</head>

<body>
	<include file="public/header2" />
	<div class="register-main">
		<div class="fd-l">手机号注册</div>
		<div class="fd-r">我已注册，马上<a href="{:U('Home/User/login')}">登录>></a></div>
		<div class="register-form">
			<form id="reg_form2"  method="post" action="">
				<ul>
					<li>
						<div class="bt">手机号码：</div>
						<input type="text" class="re-inp" placeholder="手机号码" name="username" onkeyup="this.value=this.value.replace(/[^\d]/g,'')" id="username" required>
					</li>
					<!-- <li>
						<div class="bt">验证码：</div>
						<input type="text" name="" class="re-inp-2" placeholder="验证码">
						<div class="tu"><a href=""><img src="__STATIC__/images/yzm.jpg"></a></div>
					</li> -->
					<if condition="$tpshop_config['sms_regis_sms_enable'] eq 1" >
					<li>
						<div class="bt">手机验证码：</div>
						<input type="text" class="re-inp-2" placeholder="手机验证码" id="code" name="code" required>
						<div class="tu"><button class="fn-fl icode" onclick="send_sms_reg_code()" type="button" id="count_down">发送</button></div>
						<div id="show-voice" class="show-voice"></div>
					</li>
                    <else />
                    <li>
                        <div class="bt">图像验证码：</div>
                        <input type="text" class="re-inp-2" placeholder="图像验证码" name="verify_code" id="verify_code" required>
                        <div class="tu">
                            <img width="100" height="35" src="/index.php/Home/User/verify/type/user_reg.html" id="reflsh_code2" onclick="verify('reflsh_code2')" class="po-ab to0">
                        </div>
                        <div id="show-voice" class="show-voice"></div>
                    </li>
					</if>
					<li>
						<div class="bt">设置密码：</div>
						<input type="password" class="re-inp" placeholder="请输入密码" placeholder="6-16位大小写英文字母、数字或符号的组合" autocomplete="off" maxlength="16"  id="password" name="password" value="" required="" />
					</li>
					<li>
						<div class="bt">确认密码：</div>
						<input type="password" class="re-inp" placeholder="请再次输入密码" autocomplete="off" maxlength="16" id="password2" name="password2" required value="" />
					</li>
                    <li>
                        <div class="bt">支付密码：</div>
                        <input type="password" class="re-inp" placeholder="请输入密码" placeholder="6-16位大小写英文字母、数字或符号的组合" autocomplete="off" maxlength="16"  id="paypwd" name="paypwd" value="" required="" />
                    </li>
                    <li>
                        <div class="bt">确认支付密码：</div>
                        <input type="password" class="re-inp" placeholder="请再次输入密码" autocomplete="off" maxlength="16" id="paypwd2" name="paypwd2" required value="" />
                    </li>
					<!-- <li>
                        <div class="bt">推荐人邀请码：</div>
                        <input type="text" class="re-inp" placeholder="请输入推荐人邀请码" name="invite">
                    </li> -->
					<li>
						<div class="xy">
							<div class="yz"><input type="checkbox" class="iyes fn-fl J_protocal" checked></div>
							<span>我已阅读并同意</span>
							<a href="{:U('Home/Article/detail',['article_id'=>46])}">《米豆薯服务协议》</a>
						</div>
					</li>
					<li>
						<input type="button" onClick="check_submit();" value="同意协议并注册">
					</li>
				</ul>
			</form>
		</div>
	</div>
	<include file="public/footer" />
<script>

    $(document).ready(function(){
		 $('input').click(function(){
		      $(this).siblings('p').hide();
		 });
	});
 
	// 普通 图形验证码 
    function verify(id){
        $('#'+id).attr('src','/index.php?m=Home&c=User&a=verify&type=user_reg&r='+Math.random());
    }
    function check_submit(){

        $.ajax({
            type : "POST",
            url:"{:U('Home/User/reg')}",
            dataType: "json",
            data: $('#reg_form2').serialize(),
            success: function(data){
                if(data.status == 1){
                    layer.msg(data.msg, {icon: 1},function(){
                        window.location.href = "{:U('Home/User/login')}";
                    });
                }else{
                    layer.alert(data.msg, {icon: 2},function(index){
                        $('.verifyImg').trigger('click');
                        layer.close(index);
                    });
                }
            }
        });

    }
	// 发送手机短信
    function send_sms_reg_code(){
        var mobile = $('input[name="username"]').val();
        var verify_code = $('input[name="verify_code"]').val();
        if(!checkMobile(mobile)){
            layer.alert('请输入正确的手机号码', {icon: 2});//alert('请输入正确的手机号码');
            return;
        }
        /*if(verify_code == ''){
            layer.alert('请输入图像验证码', {icon: 2});//alert('请输入正确的手机号码');
            return;
        }*/
        var url = "/index.php?m=Home&c=Api&a=send_validate_code&scene=1&type=mobile&mobile="+mobile+"&verify_code="+verify_code;
        $.ajax({
            url:url,
            dataType: "json",
            success: function(res){
            	if(res.status == 1)
    			{
    				$('#count_down').attr("disabled","disabled");
    				intAs = {$tpshop_config['sms_sms_time_out']}; // 手机短信超时时间
                    jsInnerTimeout('count_down',intAs);
                    layer.alert(res.msg, {icon: 1});
    			}else{
                    layer.alert(res.msg, {icon: 2});
                    verify('reflsh_code2')
                }
            }
        });
    }

    $('#count_down').removeAttr("disabled");
    //倒计时函数
    function jsInnerTimeout(id,intAs)
    {
        var codeObj=$("#"+id);
        //var intAs = parseInt(codeObj.attr("IntervalTime"));

        intAs--;
        if(intAs<=-1)
        {
            codeObj.removeAttr("disabled");
			// codeObj.attr("IntervalTime",60);
            codeObj.text("发送");
            return true;
        }

        codeObj.text(intAs+'秒');
		// codeObj.attr("IntervalTime",intAs);
        setTimeout("jsInnerTimeout('"+id+"',"+intAs+")",1000);
    };
    
    
    function checkMobile(tel) {
		// var reg = /(^1[3|4|5|7|8][0-9]{9}$)/;
        var reg = /^1[0-9]{10}$/;
        if (reg.test(tel)) {
            return true;
        }else{
            return false;
        };
    }

</script>
</body>
</html>