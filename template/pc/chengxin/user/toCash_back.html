<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="renderer" content="webkit">
<title>我的返利</title>
<meta name="keywords" content="{$tpshop_config['shop_info_store_keyword']}"/>
<meta name="description" content="{$tpshop_config['shop_info_store_desc']}"/>
<link rel="shortcut  icon" type="image/x-icon" href="{$tpshop_config['shop_info_store_ico']}" media="screen"  />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
<link href="__STATIC__/css/member.css?v={$vnum}" rel="stylesheet">
<link href="__STATIC__/css/style.css?v={$vnum}" rel="stylesheet">
<script src="__STATIC__/js/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>
<link type="text/css" rel="stylesheet" href="/public/plugins/daterangepicker/daterangepicker-bs3.css">
<script type="text/javascript" src="/public/plugins/daterangepicker/moment.min.js"></script>
<script type="text/javascript" src="/public/plugins/daterangepicker/daterangepicker.js"></script>
<script src="__PUBLIC__/js/global.js?v={$vnum}" type="text/javascript"></script>
<script src="__PUBLIC__/static/js/layer/layer.js" type="text/javascript"></script>
<script type="text/javascript" src="__STATIC__/js/Progress.js?v={$vnum}"></script>
<script src="__PUBLIC__/js/baidu.js"></script>
<style>
	.boldjh{font-size:12px; color:#999}

	.tab {
		margin:0;
		padding:0;
		list-style:none;
		width:300px;
		overflow:hidden;
		margin-bottom:5px;
	}
	.tab li {
		float:left;
		width:100px;
		height:40px;
		border:1px solid #ff4401;
		color:#ff4401;
		text-align:center;
		line-height:40px;
		cursor:pointer;
		font-size:14px;
		box-sizing: border-box;
	}

	.tab li:first-child{
		border-radius: 5px 0 0 0;
	}

	.tab li:last-child{
		border-radius: 0 5px 0 0;
	}
	.on {
		display:block;
	}
	.tab li.cur {
		background:#ff4401;
		color:#fff;
	}

	table{
		display: none;
	}
</style>
<script type="text/javascript">
	$(document).ready(function() {
	     $(".tab li").click(function() {
	         $(".tab li").eq($(this).index()).addClass("cur").siblings().removeClass('cur');
	         $("table").hide().eq($(this).index()).show();

	     });
	 });
</script>
<if condition="!$user.paypwd">
<script>
	layer.msg('请先设置支付密码！', {icon: 2,time: 2000},function(){
		location.href='{:U("/Home/User/paypwd_index")}';
	});
</script>
</if>
</head>
<body class="bgg">
	<include file="public/user_header" />
	<div class="clear"></div>
	
	<div class="y-content">
		<!--左侧菜单-->
		<include file="public/user_lefter" />
		
		<!--右侧内容-->
		
		<div class="y-right y-borm fri">
			<div class="y-title0">
				<span></span>我的提现
			</div>
            <div class="y-wdtx clearfix">
                <div class="qi borr fle">
                                        福利总额
                    <p><span>{$user.rebate_money_all|tk_money_format}</span>元</p>
                </div>
                <div class="qi fle">
                                        可提金额
                    <p><span>{$user.rebate_money|tk_money_format}</span>元</p>
                </div>
				<div class="qi fle">
                                        冻结金额
                    <p><span>{$user.dj_rebate|tk_money_format}</span>元</p>
                </div>
            </div>
            <div class="y-su">
                <p><input type="text" class="text" name="money_cash" id="money_cash" placeholder="提现金额" /><span>元</span></p>
                <input type="submit" id="barBtn" class="que" value="确认提现" />
                <div class="y-tan0" id="navModal">
				    <div class="boxt">
					    <button  id="closeBtn" class="close"><img src="__STATIC__/img/ico8.png"></button>
					    <p class="zzi">请输入支付密码</p>
					    <!--输入密码-->
					    <form action="" method="post" name="payPassword" id="form_paypsw">
							<div id="payPassword_container" class="alieditContainer clearfix" data-busy="0">
								<div class="i-block" data-error="i_error">
									<div class="i-block six-password">
										<input class="i-text sixDigitPassword" id="payPassword_rsainput" type="password" autocomplete="off" required value="" name="payPassword_rsainput" data-role="sixDigitPassword" tabindex="" maxlength="6" minlength="6" aria-required="true" autocomplete='new-password'>
										<div tabindex="0" class="sixDigitPassword-box" style="width: 462px;">
											<i style=" border-color: transparent;" class=""><b style="visibility: hidden;"></b></i>
											<i><b style="visibility: hidden;"></b></i>
											<i><b style="visibility: hidden;"></b></i>
											<i><b style="visibility: hidden;"></b></i>
											<i><b style="visibility: hidden;"></b></i>
											<i><b style="visibility: hidden;"></b></i>
											<span style="width: 77px; left: 0px; visibility: hidden;" id="cardwrap" data-role="cardwrap"></span>
										</div>
									</div>
								</div>
							</div>
							<input type="button" class="ren" onClick="return postcheck()" value="确认提交">
					    </form>
					    <script src="__PUBLIC__/js/dist/jquery.validate.min.js" type="text/javascript"></script>
                        <script type="text/javascript">
					         var _formPay = $('#form_paypsw');
								_formPay.validate({
									rules : {
										'payPassword_rsainput':{
											'minlength':6,
											'maxlength':6,
											required:true,
											digits : true,
											numPassword : false,
											echoNum :false
										}
									},
									messages:{
										'payPassword_rsainput':{
											'required' : '<i class="icon icon-attention icon-lg"></i>&nbsp;请填写支付密码',
//											'maxlength' : '<i class="icon icon-attention icon-lg"></i>&nbsp;密码最多为{0}个字符',
//											'minlength' : '<i class="icon icon-attention icon-lg"></i>&nbsp;密码最少为{0}个字符',
											'digits':'<i class="icon icon-attention icon-lg"></i>&nbsp;密码只能为数字',
//											'numPassword' : '<i class="icon icon-attention icon-lg"></i>&nbsp;连号不可用，相同数字不可用（如：123456，11111）',
//											'echoNum' :'<i class="icon icon-attention icon-lg"></i>&nbsp;连号不可用，相同数字不可用（如：123456，11111）'		
										}
									},
									errorPlacement : function(error, element) {
										element.closest('div[data-error="i_error"]').append(error);
									},	
									submitHandler : function(form){
										var _form = $(form);
										form.submit();
					
									}
								});
									
								var payPassword = $("#payPassword_container"),
								    _this = payPassword.find('i'),	
									k=0,j=0,
									password = '' ,
									_cardwrap = $('#cardwrap');
									//点击隐藏的input密码框,在6个显示的密码框的第一个框显示光标
									payPassword.on('focus',"input[name='payPassword_rsainput']",function(){
									
										var _this = payPassword.find('i');
										if(payPassword.attr('data-busy') === '0'){ 
										//在第一个密码框中添加光标样式
										   _this.eq(k).addClass("active");
										   _cardwrap.css('visibility','visible');
										   payPassword.attr('data-busy','1');
										}
										
									});	
									//change时去除输入框的高亮，用户再次输入密码时需再次点击
									payPassword.on('change',"input[name='payPassword_rsainput']",function(){
										_cardwrap.css('visibility','hidden');
										_this.eq(k).removeClass("active");
										payPassword.attr('data-busy','0');
									}).on('blur',"input[name='payPassword_rsainput']",function(){
										
										_cardwrap.css('visibility','hidden');
										_this.eq(k).removeClass("active");					
										payPassword.attr('data-busy','0');
										
									});
										
									//使用keyup事件，绑定键盘上的数字按键和backspace按键
									payPassword.on('keyup',"input[name='payPassword_rsainput']",function(e){
									
										var  e = (e) ? e : window.event;
									
										//键盘上的数字键按下才可以输入
										//if(e.keyCode == 8 || (e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)){
											k = this.value.length;//输入框里面的密码长度
											l = _this.size();//6
											
											for(;l--;){
											
											//输入到第几个密码框，第几个密码框就显示高亮和光标（在输入框内有2个数字密码，第三个密码框要显示高亮和光标，之前的显示黑点后面的显示空白，输入和删除都一样）
												if(l === k){
													_this.eq(l).addClass("active");
													_this.eq(l).find('b').css('visibility','hidden');
													
												}else{
													_this.eq(l).removeClass("active");
													_this.eq(l).find('b').css('visibility', l < k ? 'visible' : 'hidden');
													
												}				
											
											if(k === 6){
												j = 5;
											}else{
												j = k;
											}
											$('#cardwrap').css('left',j*30+'px');
										
											}
										/*}else{
										//输入其他字符，直接清空
											var _val = this.value;
											this.value = _val.replace(/\D/g,'');
										}*/
									});	
	
	
					    </script>
                        <!--输入end-->
				    </div>
			    </div>
			    <script type="text/javascript">
					function postcheck(){
						$.ajax({  
							url: "{:U('/Home/User/doCash')}",  
							type: 'POST',  
							data:{money_cash:$("#money_cash").val(),psw:$("#payPassword_rsainput").val()},  
							dataType: 'json',  
							error: function(){alert('系统繁忙，请稍后再试！')},
							beforeSend:function(){
								layer.load('2',{shade: 0.6});
							},
							success: function(r){
								if(r.status == 1){
									layer.msg('申请成功，请等待管理员审核', {icon: 1,time:2000,shade: 0.6},function (){
										location.reload();
									}); 
								}else{
									layer.msg(r.info, {icon: 2,time: 2000,shade: 0.6});
								}
							},
							complete:function(){
								layer.closeAll('loading');
							}
						});  
						return false;
					}
				    // --nav modal control ---
				    var bar = document.getElementById("barBtn");
				    var nav = document.getElementById("navModal");
				    var close = document.getElementById("closeBtn");
				    bar.onclick = function () {
						if($("#money_cash").val() == ''){
							return false;	
						}
				      nav.style.display="block";
				    }
				    close.onclick = function () {
				      nav.style.display="none";
				    }
			
			    </script>
                <div class="y-sm">
                    <p>福利说明：</p>
                     	福利是购买福利专区商品产生，商城将自己的利润回馈给消费者。
                </div>
            </div>
            <ul class="tab">
			    <li class="cur">订单提现</li>
			    <li>我的提现</li>
			</ul>
             <div class="qiehuan">
             	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="y-txjd on">
				<tr>
					<td width="200" class="zi">订单号</td>
				    <td width="150" class="zi">订单金额</td>
                    <td width="160" class="zi">提取到现金</td>
                    <td width="120" class="zi">提取米豆</td>
				    <td width="150" class="zi">申请日期</td>
				    <td width="130" class="zi">状态</td>
				</tr>
				<volist name="orderlist" id='vo'>
				<tr>
					<td class="zn">{$vo.order_sn}</td>
				    <td class="zn"><font color="#FF0000">{$vo.money|tk_money_format}</span></td>
                    <td class="zn">{$vo.ready|tk_money_format}</td>
                    <td class="zn">{$vo.midou|num_float2}</td>
				    <td class="zn zn2">{$vo.create_time|date="Y年m月d日 H:i:s",###}</td>
				    <td class="zn">{$vo.status|check_withdrawal} <if condition="$vo.status eq -1"> <a href="JavaScript:;" onClick="als_msg('{$vo.id}')">详情</a>
					<input type="hidden" id="msg_{$vo.id}" value="{$vo.remark|nl2br}">
					 </if></td>
				</tr>
				</volist>
            </table>
            <!--分页-->
            <div class="y-sxfy  tco" style="text-align:center">
               {$page->show()}
            </div>
             </div>
            <div class="qiehuan">
            	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="y-txjd">
				<tr>
				    <td width="337" class="zi">提现金额</td>
				    <td width="360" class="zi">日期</td>
				    <td width="223" class="zi">状态</td>
				</tr>
				<volist name="list" id='vo'>
				<tr>
				    <td class="zn"><span>{$vo.total|tk_money_format}</span>元</td>
				    <td class="zn zn2">{$vo.create_time|date="Y年m月d日 H:i:s",###}</td>
				    <td class="zn">{$vo.status|check_withdrawal} <if condition="$vo.status eq -1"> <a href="JavaScript:;" onClick="als_msg('{$vo.id}')">详情</a>
					<input type="hidden" id="msg_{$vo.id}" value="{$vo.remark|nl2br}">
					 </if></td>
				</tr>
				</volist>
            </table>
               <!--分页-->
                <div class="y-sxfy  tco" style="text-align:center">
                   {$order_page->show()}
                </div>
                
            </div>
            <style>
				.pagination{}
				.pagination li{float:left}
			</style>
			
            <div class="y-wx">
            	<p>温馨提示：</p>
                                提现中如遇到问题请拨打客服热线<br />
                                客服热线：<span>400-110-8690</span>
            </div>
            
		</div>
		<div class="clear"></div>
	</div>


	<script>
		function als_msg(id){
			layer.alert($("#msg_"+id).val(), {
			  icon:2,
			  shade: 0.6, //该皮肤由layer.seaning.com友情扩展。关于皮肤的扩展规则，去这里查阅
			})
		}
		
	</script>
		
		<!--右侧内容结束-->
	<include file="public/user_footer" />
	
</body>
</html>