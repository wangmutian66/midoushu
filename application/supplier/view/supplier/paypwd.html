<include file="public/layout" />
<script type="text/javascript" src="__ROOT__/public/static/js/layer/laydate/laydate.js"></script>
<link href="__STATIC__/css/ghs-style.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<div class="ghs-xgmm">
		<div class="top">
			<div class="bt">修改密码<div title="刷新数据" class="pReload"><i class="fa fa-refresh"></i></div></div>
			
		</div>
		<if condition="$step eq 1">
			<div class="bd">
				<div class="bz">
					<div class="bz-01">身份验证</div>
					<div class="bz-02">提现密码</div>
					<div class="bz-03">完成设置</div>
				</div>
				<form action="" method="post" class="yzm">
					<input type="hidden" name="mobile" id="mobile" value="{$supplier.suppliers_phone}" />
					<div class="yz">
						<div class="xx">
							<span>商户名称为：{$supplier.suppliers_email}</span>
							<sapn>商户绑定电话：{$supplier.suppliers_phone}</sapn>
						</div>
						<div class="line-1">
							<input type="text" id="code" name="code" class="inp-1" placeholder="输入短信验证码...">
							<input class="fs" type="button" name="" onclick="sendcode(this)" value="获取验证码" />
						</div>
						<div class="line-1">
							<input type="button" onclick="nextstep()" class="inp-2" value="确认验证">
						</div>
					</div>
				</form>
			</div>
		</if>
		<if condition="$step eq 2">
			<div class="bd">
				<div class="bz">
					<div class="bz-01 ys">身份验证</div>
					<div class="bz-02 ys">提现密码</div>
					<div class="bz-03">完成设置</div>
				</div>
				<form action="" method="post" class="yzm" id="pwdform">
					<div class="yz">
						<div class="line-1 ys">
							<span>新的密码：</span>
							<input type="password" class="inp-1" name="new_password" id="new_password" value=""placeholder="6-16位字母、数字或符号组合" onkeyup="securityLevel(this.value)">
						</div>
						<div class="line-1 ys">
							<span>确认密码：</span>
							<input type="password" class="inp-1" name="confirm_password" id="confirm_password" value="" placeholder="6-16位字母、数字或符号组合">
						</div>
						<div class="line-1">
							<input type="hidden" name="step" value="3">
							<input type="button" onclick="checkSubmit()" class="inp-2" value="确认填写">
						</div>
					</div>
				</form>
			</div>
		</if>
		<if condition="$step eq 3">
			<div class="bd">
				<div class="bz">
					<div class="bz-01 ys">身份验证</div>
					<div class="bz-02">提现密码</div>
					<div class="bz-03 ys">完成设置</div>
				</div>
				<div class="yz">
					<div class="xx">
						<span class="ys">恭喜您，已成功设置密码！</span>
					</div>
					<div class="yes"><img src="__STATIC__/images/yes.png"></div>
				</div>
			</div>
		</if>
	</div>
	<script type="text/javascript">
		function sendcode(o){
			$.ajax({
				url:'/index.php?m=Home&c=Api&a=send_validate_code&scene=6&t='+Math.random(),
				type:'get',
				dataType:'json',
				data:{type:'phone',send:$('#mobile').val()},
				success:function(res){
					if(res.status==1){
						layer.alert(res.msg, {icon: 1});
						timer(o);
					}else{
						layer.alert(res.msg, {icon: 2});
					}
				}
			})
		}

		var wait={$tpshop_config['sms_sms_time_out']};
		function timer(o) {
		    if (wait == 0) {  
		        o.removeAttribute("disabled");            
		        o.value="获取验证码";  
		        wait = {$tpshop_config['sms_sms_time_out']};
		    } else {  
		        o.setAttribute("disabled", true);  
		        o.classList.add("fsyz1");
		        o.value="重新发送(" + wait + ")";  
		        wait--;  
		        setTimeout(function() {  
		          timer(o)  
		        }, 1000)  
		    }  
		}
		
		function nextstep(){
			var code = $('#code').val();
			if(code == ''){
				layer.alert('验证码不能为空', {icon: 2});
				return false;
			}
			if(code.length != 6){
				layer.alert('验证码错误', {icon: 2});
				return false;
			}
			$.ajax({
				url:'/index.php?m=Supplier&c=Api&a=check_validate_code&t='+Math.random(),
				type:'post',
				dataType:'json',
				data:{type:'phone',code:code,send:$('#mobile').val(),scene:6},
				success:function(res){
					if(res.status==1){
						is_check = true;
						window.location.href='/index.php?m=Supplier&c=Supplier&a=paypwd&step=2&t='+Math.random();
					}else{
						layer.alert(res.msg, {icon: 2});
						return false;
					}
				}
			})
		}
		
		function checkSubmit(){
			var new_password = $('#new_password').val();
			var confirm_password = $('#confirm_password').val();
			if(new_password == ''){
				layer.alert('新支付密码不能为空', {icon: 2});
				return false;
			}
			if(new_password.length<6 || new_password.length>18){
				layer.alert('密码长度不符合规范', {icon: 2});
				return false;
			}
			if(new_password != confirm_password){
				layer.alert('两次密码不一致', {icon: 2});
				return false;
			}
			$('#pwdform').submit();
		}
	</script>
</body>
</html>