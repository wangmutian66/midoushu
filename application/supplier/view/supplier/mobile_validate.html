<include file="public/layout" />
<script type="text/javascript" src="__ROOT__/public/static/js/layer/laydate/laydate.js"></script>
<link href="__STATIC__/css/ghs-style.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<div class="ghs-xgmm">
		<div class="top">
			<div class="bt">绑定手机<div title="刷新数据" class="pReload"><i class="fa fa-refresh"></i></div></div>
		</div>
		
		<if condition="$step eq 1">
			<div class="y-shr">
	            <form action="" method="post" onSubmit="return check_form();" class="yzm">
			        <div class="zhmm">
			        	<h6>原手机：</h6>
	                    <input type="text" class="hao" id="mobile" name="mobile" onpaste="this.value=this.value.replace(/[^\d]/g,'')" onkeyup="this.value=this.value.replace(/[^\d]/g,'')" />
			        </div>
			        <div class="zhmm">
			        	<h6>验证码：</h6>
			            <input type="text" class="c_code_msg2" name="code" id="new_code">
			            <input type="button" intervaltime="{$time}" value="获取验证码 " id="btnemailAuthCode2" onClick="sendCode(this,'mobile')" class="fsyz"  />
			        </div>
			        <div class="zhmm">
			        	<h6>&nbsp;</h6>
			        	<input type="hidden" name="step" value="2">
			            <button class="xyb" type="submit"> 下一步 </button>
			        </div>
		        </form>
	        </div>
        </if>
		<if condition="$step eq 2">
			<div class="y-shr">
	            <form action="" method="post" onSubmit="return check_form();" class="yzm">
			        <div class="zhmm">
			        	<h6>新手机：</h6>
	                    <input type="text" class="hao" id="mobile" name="mobile" onpaste="this.value=this.value.replace(/[^\d]/g,'')" onkeyup="this.value=this.value.replace(/[^\d]/g,'')" />
			        </div>
			        <div class="zhmm">
			        	<h6>验证码：</h6>
			            <input type="text" class="c_code_msg2" name="code" id="new_code">
			            <input type="button" intervaltime="{$time}" value="获取验证码 " id="btnemailAuthCode2" onClick="sendCode(this,'mobile')" class="fsyz"  />
			        </div>
			        <div class="zhmm">
			        	<h6>&nbsp;</h6>
			        	<input type="hidden" name="step" value="3">
			            <button class="xyb" type="submit"> 提 交 </button>
			        </div>
		        </form>
	        </div>
		</if>


	</div>
	<script>
	    // 表单提交验证
	    function check_form()
	    {
	        var mobile = $('#mobile').val();
	        //原邮箱不为空的情况下 验证格式
	        if(!checkMobile(mobile)){
	            layer.alert('手机格式错误', {icon: 2});//alert('新手机格式错误');
	            return false;
	        }

	        if($.trim($('#new_code').val()) == '')
	        {
	            layer.alert('验证码不能为空', {icon: 2});//alert('验证码不能为空');
	            return false;
	        }
	        return true;
	    }

	    function sendCode(obj,input_id){
	        var id = $(obj).attr('id');
	        var input = $('#'+input_id).val();

	        if(!checkMobile(input)){
	            layer.alert('手机号码格式错误', {icon: 2});//alert('手机号码格式错误');
	            return false;
	        }

	        var url = "/index.php?m=Home&c=Api&a=send_validate_code&scene=6&type=mobile&send="+input;
	        //发送验证码
	        $.ajax({
	            type : "GET",
	            url  : url,
	            dataType : 'json',
	            error: function(request) {
	                layer.alert('服务器繁忙, 请联系管理员!', {icon: 2});//alert("服务器繁忙, 请联系管理员!");
	                return;
	            },
	            success: function(res) {
	                if(res.status == 1){
	                    layer.alert(res.msg,{icon: 1});
	                    jsInnerTimeout(id);
	                }else{
	                    layer.alert(res.msg,{icon: 2}); //alert('发送失败');
	                }
	            }
	        });
	    }

	    //倒计时函数
	    function jsInnerTimeout(id)
	    {
	        var codeObj=$("#"+id);
	        var intAs= parseInt(codeObj.attr("IntervalTime"));

	        intAs--;
	        codeObj.attr("disabled","disabled");
	        if(intAs<=-1)
	        {
	            codeObj.removeAttr("disabled");
	            codeObj.attr("IntervalTime",{$time});
	            codeObj.val("获取验证码");
	            return true;
	        }

	        codeObj.val(intAs+'s后再次获取');
	        codeObj.attr("IntervalTime",intAs);

	        setTimeout("jsInnerTimeout('"+id+"')",1000);
	    };

	    $("#btnemailAuthCode2").removeAttr("disabled");
	</script>
</body>
</html>